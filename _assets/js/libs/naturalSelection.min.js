jQuery.fn.naturalSelection=function(){var e=this.length;return this.each(function(t){var n=$(this),a=n.attr("id"),i=n.attr("name");n.after('<div class="naturalSelection-wrapper"></div>');var l=n.next(".naturalSelection-wrapper");l.prepend('<a href="" class="naturalSelection-active"></a>'),l.append('<ul class="naturalSelection-inner"></ul>'),l.append('<input type="hidden" class="naturalSelection-hidden" name="'+i+'"/>');{var r=l.find(".naturalSelection-inner");r.find(".naturalSelection-active"),r.find(".naturalSelection-hidden")}r.addClass("naturalSelection--hide"),r.css("z-index",10*(e-t)),n.find("option").each(function(e){var t=$(this).val(),a=$(this).text();0==t.length&&(t=a);var i=$(this).attr("selected");i&&i.length>0?(r.prev(".naturalSelection-active").text(a),r.next(".naturalSelection-hidden").val(t)):0==e&&r.prev(".naturalSelection-active").text(a);var l=[],c="<li";0==e&&l.push("first"),e+1==n.find("option").length&&l.push("last"),i&&i.length>0&&l.push("active"),c+=' class="'+l.join(" ")+'"',c+='><a href="#" class="naturalSelection-item" data-value="'+t+'">'+a+"</a></li>",r.append(c)}),r.prev(".naturalSelection-active").on("click",function(e){e.preventDefault();var t=$(this).next(".naturalSelection-inner");0==t.find(".active").length?t.toggleClass("naturalSelection--hide").find(".naturalSelection-item:eq(0)").focus():t.toggleClass("naturalSelection--hide").find(".active").find(".naturalSelection-item").focus(),$(this).parents(".content-wrapper").siblings(".content-wrapper").find(".naturalSelection-inner").addClass("naturalSelection--hide")}).on("keyup",function(e){(38==e.keyCode||40==e.keyCode)&&($(this).next(".naturalSelection-inner").toggleClass("naturalSelection--hide").find(".active").find(".naturalSelection-item").focus(),$(this).parents(".content-wrapper").siblings(".content-wrapper").find(".naturalSelection-inner").addClass("naturalSelection--hide"))}),r.on("click",".naturalSelection-item",function(e){e.preventDefault();var t=$(this).data("value"),n=$(this).text();r.prev(".naturalSelection-active").text(n),$(this).parents(".naturalSelection-inner").next(".naturalSelection-hidden").val(t),$(this).parents(".naturalSelection-inner").addClass("naturalSelection--hide"),$(this).parents("li").addClass("active").siblings("li").removeClass("active")}),$("body").on("click",function(e){var t=$(e.target);0!=t.parents(".naturalSelection-inner").length||t.is(".naturalSelection-active")||t.is("label[for="+a+"]")||r.addClass("naturalSelection--hide")}),n.remove(),r.on("keyup",".naturalSelection-item",function(e){var t=$(this).parent("li"),n=t.index(),a=t.siblings("li").length;38==e.keyCode&&n>0?t.removeClass("active").prev("li").addClass("active").find(".naturalSelection-item").focus():40==e.keyCode&&a>n&&t.removeClass("active").next("li").addClass("active").find(".naturalSelection-item").focus()}),$("label[for="+a+"]").on("click",function(){r.toggleClass("naturalSelection--hide"),r.is(".naturalSelection--hide")||(0==r.find(".active").length?r.find(".naturalSelection-item:eq(0)").focus():r.find(".active").find(".naturalSelection-item").focus())})})};